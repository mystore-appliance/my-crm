<div style="max-width:700px;margin:auto;padding:20px;"></div>
<!DOCTYPE html>

<html lang="en">
<head>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<meta charset="utf-8"/>
<title>MY Master CRM — Appliance CRM System</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&amp;display=swap" rel="stylesheet"/>
<style>
    body {
      font-family: 'Inter', sans-serif;
      background: linear-gradient(to right, #ffffff, #f1f1f1);
      margin: 0; padding: 0;
      color: #2A2A2A;
    }
    .container {
  margin-top: 80px;
      max-width: 900px;
      margin: auto;
      padding: 40px;
      background: #ffffff;
      border-radius: 12px;
      box-shadow: 0 0 20px rgba(0,0,0,0.05);
      margin-top: 40px;
    }
    h1, h2 {
      text-align: center;
      color: #e36227;
      margin-bottom: 20px;
    }
    label {
      display: block;
      margin-top: 15px;
      font-weight: 600;
    }
    input, select, textarea, button {
      width: 100%;
      padding: 12px;
      margin-top: 5px;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 15px;
      box-sizing: border-box;
    }
    .tooltip {
      font-size: 12px;
      color: #666;
      margin-top: 2px;
    }
    button {
      background: #e36227;
      color: white;
      border: none;
      font-weight: 600;
      cursor: pointer;
      margin-top: 20px;
      transition: background 0.3s ease;
    }
    button:hover {
      background: #c24f1f;
    }
    .form-section {
      margin-bottom: 60px;
    }
    img.preview {
      max-width: 100px;
      margin-top: 10px;
      display: none;
      border-radius: 8px;
    }
    .nav-step, .after-submit {
      display: flex;
      flex-direction: column;
      gap: 15px;
      max-width: 500px;
      margin: 30px auto;
    }
    .nav-step button, .after-submit button {
      font-size: 16px;
      padding: 15px;
      border-radius: 8px;
    }
    .hidden {
      display: none;
    }
    .logo {
      display: block;
      margin: 20px auto 30px auto;
      max-width: 180px;
    }
    .back-btn {
      text-align: center;
      margin-top: 30px;
    }
    .back-btn button {
      background: none;
      color: #e36227;
      border: 2px solid #e36227;
    }
  
.container {
  opacity: 0;
  transform: translateY(30px);
  transition: opacity 0.4s ease, transform 0.4s ease;
}
.container:not(.hidden) {
  opacity: 1;
  transform: translateY(0);
}
.mobile-nav {
  display: none;
}
@media (max-width: 600px) {
  .mobile-nav {
    display: flex;
    position: fixed;
    bottom: 0;
    width: 100%;
    background: white;
    border-top: 1px solid #ddd;
    justify-content: space-around;
    padding: 10px 0;
    z-index: 100;
  }
  .mobile-nav button {
    background: none;
    border: none;
    font-size: 16px;
    color: #e36227;
    font-weight: bold;
  }
}

.header-banner {
  background-color: #2a2a2a;
  color: white;
  padding: 20px;
  margin: -40px -40px 30px -40px;
  border-top-left-radius: 12px;
  border-top-right-radius: 12px;
  text-align: center;
  font-size: 24px;
  font-weight: 600;
}
</style>
</head>
<body>
<div class="container" id="step-one">
<h1>MY Master CRM</h1>
<p style="text-align:center;">Выберите, что вы хотите сделать:</p>
<div class="nav-step">
<button onclick="showForm('unit-form-block')" style="background:#e36227;color:#fff;padding:10px 15px;border:none;margin:10px 5px;border-radius:6px;cursor:pointer;font-size:16px;">Добавить Юнит</button>
<button onclick="showForm('part-form-block')" style="background:#e36227;color:#fff;padding:10px 15px;border:none;margin:10px 5px;border-radius:6px;cursor:pointer;font-size:16px;">Добавить Деталь</button>
<button onclick="showForm('stats-block')" style="background:#e36227;color:#fff;padding:10px 15px;border:none;margin:10px 5px;border-radius:6px;cursor:pointer;font-size:16px;">Сводная Статистика</button>
</div>
</div>
<div class="container hidden" id="unit-form-block">
<h2 class="header-banner" style="background:#2a2a2a;color:white;padding:12px 20px;border-radius:6px 6px 0 0;font-size:20px;margin-bottom:10px;text-align:center;">Добавить Юнит</h2>
<form onsubmit="return previewBeforeSubmit(this, 'unit-confirmation');">
<label>ID юнита</label>
<input required type="text" style="display:block;width:100%;padding:10px;margin:10px 0;font-size:16px;border:1px solid #ccc;border-radius:6px;">
<div class="tooltip">Присвойте уникальный ID этому юниту</div>

<label>Дата добавления</label>
<input required="" style="display:block;width:100%;padding:10px;margin:10px 0;font-size:16px;border:1px solid #ccc;border-radius:6px;" type="date"/ value="2025-04-13">
<div class="tooltip">Укажите дату добавления юнита в систему</div>
<label>Категория</label>
<select required="" style="display:block;width:100%;padding:10px;margin:10px 0;font-size:16px;border:1px solid #ccc;border-radius:6px;"><option disabled="" selected="" value="">Выбрать из списка</option>
<option>Washer</option><option>Dryer</option><option>Dishwasher</option>
<option>Refrigerator</option><option>Freezer</option><option>Microwave</option>
<option>Cooktop</option><option>Ovens</option><option>Coffee Makers</option>
<option>Coffee Machines</option><option>Electric Laundry Tower</option>
<option>Gas Laundry Tower</option><option>Laundry Center</option><option>Range</option>
</select>
<div class="tooltip">Выберите категорию устройства</div>
<label>Бренд</label>
<select required="" style="display:block;width:100%;padding:10px;margin:10px 0;font-size:16px;border:1px solid #ccc;border-radius:6px;"><option disabled="" selected="" value="">Выбрать из списка</option>
<option>Whirlpool</option><option>GE Appliances</option><option>Samsung</option>
<option>LG</option><option>Maytag</option><option>Frigidaire</option>
<option>Bosch</option><option>KitchenAid</option><option>Electrolux</option>
<option>Amana</option><option>Kenmore</option><option>Haier</option>
<option>Speed Queen</option><option>Viking</option><option>Sub-Zero</option>
</select>
<div class="tooltip">Выберите бренд устройства</div>
<label>Модель</label>
<input required="" style="display:block;width:100%;padding:10px;margin:10px 0;font-size:16px;border:1px solid #ccc;border-radius:6px;" type="text"/>
<label>Серийный номер</label>
<input >
<label>Поломка</label>
<textarea placeholder="Опишите, что не работает или сломано..." required="" style="display:block;width:100%;padding:10px;margin:10px 0;font-size:16px;border:1px solid #ccc;border-radius:6px;"></textarea>
<label>Состояние</label>
<select required="" style="display:block;width:100%;padding:10px;margin:10px 0;font-size:16px;border:1px solid #ccc;border-radius:6px;"><option disabled="" selected="" value="">Выбрать из списка</option>
<option>Рабочее</option>
<option>На запчасти</option>
</select>
<label>Цена закупки ($)</label>
<input required="" step="0.01" style="display:block;width:100%;padding:10px;margin:10px 0;font-size:16px;border:1px solid #ccc;border-radius:6px;" type="number"/>
<label>Фото</label>
<input accept="image/*" onchange="previewImage(this, 'unit-preview')" style="display:block;width:100%;padding:10px;margin:10px 0;font-size:16px;border:1px solid #ccc;border-radius:6px;" type="file"/>
<img class="preview" id="unit-preview" style="max-width:150px;display:none;margin-top:10px;border-radius:8px;border:1px solid #ddd;"/>
<label>Комментарий</label>
<textarea placeholder="Дополнительные примечания..." style="display:block;width:100%;padding:10px;margin:10px 0;font-size:16px;border:1px solid #ccc;border-radius:6px;"></textarea>
<button style="background:#e36227;color:#fff;padding:10px 15px;border:none;margin:10px 5px;border-radius:6px;cursor:pointer;font-size:16px;" type="submit">Сохранить Юнит</button>
</form>
<div class="back-btn"><button onclick="goBack()" style="background:#e36227;color:#fff;padding:10px 15px;border:none;margin:10px 5px;border-radius:6px;cursor:pointer;font-size:16px;">Назад</button></div>
</div>
<div class="container hidden" id="part-form-block">
<h2 class="header-banner" style="background:#2a2a2a;color:white;padding:12px 20px;border-radius:6px 6px 0 0;font-size:20px;margin-bottom:10px;text-align:center;">Добавить Деталь</h2>
<form id="part-form" onsubmit="return previewBeforeSubmit(this, 'part-confirmation');">
<label>ID юнита</label>
<input required="" style="display:block;width:100%;padding:10px;margin:10px 0;font-size:16px;border:1px solid #ccc;border-radius:6px;" type="text"/>
<div class="tooltip">Введите ID юнита, с которого снята эта деталь</div>



<label>ID детали</label>
<input required type="text" style="display:block;width:100%;padding:10px;margin:10px 0;font-size:16px;border:1px solid #ccc;border-radius:6px;">
<div class="tooltip">Уникальный ID этой детали</div>
<label>Категория юнита</label>
<select required style="display:block;width:100%;padding:10px;margin:10px 0;font-size:16px;border:1px solid #ccc;border-radius:6px;">
  <option disabled selected value="">Выбрать из списка</option>
  <option>Washer</option><option>Dryer</option><option>Dishwasher</option>
  <option>Refrigerator</option><option>Freezer</option><option>Microwave</option>
  <option>Cooktop</option><option>Ovens</option><option>Coffee Makers</option>
  <option>Coffee Machines</option><option>Electric Laundry Tower</option>
  <option>Gas Laundry Tower</option><option>Laundry Center</option><option>Range</option>
</select>
<div class="tooltip">Выберите категорию юнита, от которого деталь</div>
<label>Категория детали</label>
<select required style="display:block;width:100%;padding:10px;margin:10px 0;font-size:16px;border:1px solid #ccc;border-radius:6px;">
  <option disabled selected value="">Выбрать из списка</option>
  <option>Main Components</option>
  <option>Heating & Cooling</option>
  <option>Sensors & Electronics</option>
  <option>User Interface</option>
  <option>Doors & Seals</option>
  <option>Filtration</option>
  <option>Structural Parts</option>
  <option>Accessories</option>
  <option>Other / Miscellaneous</option>
</select>
<div class="tooltip">Выберите категорию детали</div>

<label>Название детали</label>
<input required="" style="display:block;width:100%;padding:10px;margin:10px 0;font-size:16px;border:1px solid #ccc;border-radius:6px;" type="text"/>
<label>Состояние детали</label>
<select style="display:block;width:100%;padding:10px;margin:10px 0;font-size:16px;border:1px solid #ccc;border-radius:6px;"><option disabled="" selected="" value="">Выбрать из списка</option>
<option>Новое</option><option>Как новое</option><option>Рабочее</option>
<option>Восстановленное</option><option>Брак</option>
</select>
<label>Фото детали</label>
<input accept="image/*" onchange="previewImage(this, 'part-preview')" style="display:block;width:100%;padding:10px;margin:10px 0;font-size:16px;border:1px solid #ccc;border-radius:6px;" type="file"/>
<img class="preview" id="part-preview" style="max-width:150px;display:none;margin-top:10px;border-radius:8px;border:1px solid #ddd;"/>
<label>Цена продажи ($)</label>
<input name="price" step="0.01" style="display:block;width:100%;padding:10px;margin:10px 0;font-size:16px;border:1px solid #ccc;border-radius:6px;" type="number"/>
<label>Комиссия eBay ($)</label>
<input name="fee" step="0.01" style="display:block;width:100%;padding:10px;margin:10px 0;font-size:16px;border:1px solid #ccc;border-radius:6px;" type="number"/>
<label>Профит ($)</label>
<input id="profitField" name="profit" placeholder="Считается автоматически" readonly="readonly" style="display:block;width:100%;padding:10px;margin:10px 0;font-size:16px;border:1px solid #ccc;border-radius:6px;" type="number"/>
<label>Дата добавления</label>
<input name="price" style="display:block;width:100%;padding:10px;margin:10px 0;font-size:16px;border:1px solid #ccc;border-radius:6px;" type="date"/ value="2025-04-13">
<label>Ссылка на лот eBay</label>
<input name="fee" style="display:block;width:100%;padding:10px;margin:10px 0;font-size:16px;border:1px solid #ccc;border-radius:6px;" type="url"/>
<button style="background:#e36227;color:#fff;padding:10px 15px;border:none;margin:10px 5px;border-radius:6px;cursor:pointer;font-size:16px;" type="submit">Сохранить Деталь</button>
</form>
<div class="back-btn"><button onclick="goBack()" style="background:#e36227;color:#fff;padding:10px 15px;border:none;margin:10px 5px;border-radius:6px;cursor:pointer;font-size:16px;">Назад</button></div>
</div>
<div class="container hidden" id="unit-confirmation">
<h2 style="background:#2a2a2a;color:white;padding:12px 20px;border-radius:6px 6px 0 0;font-size:20px;margin-bottom:10px;text-align:center;">Проверьте данные Юнита</h2>
<div id="unit-data-preview"></div>
<button onclick="submitFinal('unit')" style="background:#e36227;color:#fff;padding:10px 15px;border:none;margin:10px 5px;border-radius:6px;cursor:pointer;font-size:16px;">Отправить в систему учёта</button>
<div class="back-btn"><button onclick="showForm('unit-form-block')" style="background:#e36227;color:#fff;padding:10px 15px;border:none;margin:10px 5px;border-radius:6px;cursor:pointer;font-size:16px;">Назад к редактированию</button></div>
</div>
<div class="container hidden" id="part-confirmation">
<h2 style="background:#2a2a2a;color:white;padding:12px 20px;border-radius:6px 6px 0 0;font-size:20px;margin-bottom:10px;text-align:center;">Проверьте данные Детали</h2>
<div id="part-data-preview"></div>
<button onclick="submitFinal('part')" style="background:#e36227;color:#fff;padding:10px 15px;border:none;margin:10px 5px;border-radius:6px;cursor:pointer;font-size:16px;">Отправить в систему учёта</button>
<div class="back-btn"><button onclick="showForm('part-form-block')" style="background:#e36227;color:#fff;padding:10px 15px;border:none;margin:10px 5px;border-radius:6px;cursor:pointer;font-size:16px;">Назад к редактированию</button></div>
</div>
<div class="container hidden" id="stats-block">
<h2 style="background:#2a2a2a;color:white;padding:12px 20px;border-radius:6px 6px 0 0;font-size:20px;margin-bottom:10px;text-align:center;">Сводная статистика</h2>
<p style="text-align:center;">📊 Тут появится аналитика: графики, остатки, прибыль и категории</p>
<div class="back-btn"><button onclick="goBack()" style="background:#e36227;color:#fff;padding:10px 15px;border:none;margin:10px 5px;border-radius:6px;cursor:pointer;font-size:16px;">Назад</button></div>
</div>
<div class="container hidden" id="success-block">
<h2 style="background:#2a2a2a;color:white;padding:12px 20px;border-radius:6px 6px 0 0;font-size:20px;margin-bottom:10px;text-align:center;">Данные успешно добавлены!</h2>
<div class="after-submit">
<button onclick="showForm('unit-form-block')" style="background:#e36227;color:#fff;padding:10px 15px;border:none;margin:10px 5px;border-radius:6px;cursor:pointer;font-size:16px;">Добавить ещё Юнит</button>
<button onclick="showForm('part-form-block')" style="background:#e36227;color:#fff;padding:10px 15px;border:none;margin:10px 5px;border-radius:6px;cursor:pointer;font-size:16px;">Добавить ещё Деталь</button>
<button onclick="showForm('stats-block')" style="background:#e36227;color:#fff;padding:10px 15px;border:none;margin:10px 5px;border-radius:6px;cursor:pointer;font-size:16px;">Посмотреть статистику</button>
</div>
</div>
<script>
function showForm(id) {
  ['step-one','unit-form-block','part-form-block','stats-block','success-block','unit-confirmation','part-confirmation'].forEach(x => {
    const el = document.getElementById(x);
    if (el) el.classList.add('hidden');
  });
  document.getElementById(id).classList.remove('hidden');
}

function previewBeforeSubmit(form, confirmId) {
  const previewBlock = document.getElementById(confirmId === 'unit-confirmation' ? 'unit-data-preview' : 'part-data-preview');
  let values = '';
  const inputs = form.querySelectorAll('input, select, textarea');
  inputs.forEach(el => {
    const labelEl = el.closest('label') || el.previousElementSibling;
    const label = labelEl ? labelEl.innerText : el.name || el.placeholder || 'Поле';
    let value = '';
    if (el.type === 'file') {
      value = el.files.length > 0 ? el.files[0].name : 'Файл не выбран';
    } else if (el.type === 'checkbox' || el.type === 'radio') {
      if (el.checked) value = el.value;
    } else {
      value = el.value || '(пусто)';
    }
    if (label) {
      values += `<p><strong>${label}:</strong> ${value}</p>`;
    }
  });
  previewBlock.innerHTML = values;
  showForm(confirmId);
  return false;
}

function submitFinal(type) {
  showForm('success-block');
}

function goBack() {
  showForm('step-one');
}

document.addEventListener('DOMContentLoaded', function () {
  const partForm = document.querySelector('#part-form-block form');
  if (partForm) {
    partForm.addEventListener('input', function () {
      const price = parseFloat(partForm.querySelector('input[name="price"]').value) || 0;
      const fee = parseFloat(partForm.querySelector('input[name="fee"]').value) || 0;
      const profit = price - fee;
      const profitInput = partForm.querySelector('input[name="profit"]');
      if (profitInput) {
        profitInput.value = profit.toFixed(2);
      }
    });
  }
});

document.addEventListener('DOMContentLoaded', function () {
  const priceInput = document.querySelector('input[name="price"]');
  const feeInput = document.querySelector('input[name="fee"]');
  const profitInput = document.querySelector('input[name="profit"]');

  if (priceInput && feeInput && profitInput) {
    const calculateProfit = () => {
      const price = parseFloat(priceInput.value) || 0;
      const fee = parseFloat(feeInput.value) || 0;
      profitInput.value = (price - fee).toFixed(2);
    };

    priceInput.addEventListener('input', calculateProfit);
    feeInput.addEventListener('input', calculateProfit);
  }
});

document.addEventListener('DOMContentLoaded', function () {
  const priceInput = document.querySelector('input[name="price"]');
  const feeInput = document.querySelector('input[name="fee"]');
  const profitInput = document.querySelector('input[name="profit"]');

  if (priceInput && feeInput && profitInput) {
    function calculateProfit() {
      const price = parseFloat(priceInput.value) || 0;
      const fee = parseFloat(feeInput.value) || 0;
      const profit = price - fee;
      profitInput.value = profit.toFixed(2);
    }

    priceInput.addEventListener('input', calculateProfit);
    feeInput.addEventListener('input', calculateProfit);
  }
});
</script>
<div class="mobile-nav" style="display:none;">
<button onclick="showForm('unit-form-block')" style="background:#e36227;color:#fff;padding:10px 15px;border:none;margin:10px 5px;border-radius:6px;cursor:pointer;font-size:16px;">Юнит</button>
<button onclick="showForm('part-form-block')" style="background:#e36227;color:#fff;padding:10px 15px;border:none;margin:10px 5px;border-radius:6px;cursor:pointer;font-size:16px;">Деталь</button>
<button onclick="showForm('stats-block')" style="background:#e36227;color:#fff;padding:10px 15px;border:none;margin:10px 5px;border-radius:6px;cursor:pointer;font-size:16px;">Статистика</button>
</div>


<style>
@media (max-width: 1024px) {
  #unit-form, #part-form {
    margin-top: 0px !important;
    padding-top: 0px !important;
  }
  .tilda-block {
    margin-top: 0px !important;
    padding-top: 0px !important;
  }
}
</style>


<script>
document.addEventListener('DOMContentLoaded', function () {
  // === Автогенерация ID юнита ===
  const unitIdInput = document.querySelector('#unit-form-block input[type="text"]');
  let units = JSON.parse(localStorage.getItem('unitIds') || '[]');
  if (unitIdInput && units.length >= 0) {
    const nextUnitNumber = units.length + 1;
    const newUnitId = 'U' + nextUnitNumber.toString().padStart(4, '0');
    unitIdInput.value = newUnitId;
  }

  // === Сохраняем новый юнит в localStorage при сабмите ===
  const unitForm = document.querySelector('#unit-form-block form');
  unitForm.addEventListener('submit', function () {
    const unitId = unitIdInput.value;
    if (!units.includes(unitId)) {
      units.push(unitId);
      localStorage.setItem('unitIds', JSON.stringify(units));
      localStorage.setItem(unitId + '_parts', JSON.stringify([]));
    }
  });

  // === Выпадающий список ID юнитов в форме детали ===
  const unitSelectContainer = document.querySelector('#part-form-block input[placeholder*="ID юнита"]')?.parentElement;
  const manualInput = document.querySelector('#part-form-block input[placeholder*="ID юнита"]');
  if (unitSelectContainer && manualInput) {
    const select = document.createElement('select');
    select.style = manualInput.style.cssText;
    const opt = document.createElement('option');
    opt.text = 'Выбрать из списка';
    opt.disabled = true;
    opt.selected = true;
    select.appendChild(opt);

    units.forEach(id => {
      const o = document.createElement('option');
      o.text = id;
      o.value = id;
      select.appendChild(o);
    });

    select.addEventListener('change', () => {
      manualInput.value = select.value;
      generateDetailId(select.value);
    });

    unitSelectContainer.insertBefore(select, manualInput);
  }

  // === Автогенерация ID детали ===
  const detailIdInput = document.querySelector('#part-form-block input[placeholder*="ID детали"]');
  const unitIdInputInPart = document.querySelector('#part-form-block input[placeholder*="ID юнита"]');

  function generateDetailId(unitId) {
    let parts = JSON.parse(localStorage.getItem(unitId + '_parts') || '[]');
    const nextPart = parts.length + 1;
    const newPartId = unitId + '-P' + nextPart.toString().padStart(3, '0');
    if (detailIdInput) detailIdInput.value = newPartId;
  }

  // === При сабмите формы детали — сохраняем её ID ===
  const partForm = document.querySelector('#part-form-block form');
  partForm.addEventListener('submit', function () {
    const unitId = unitIdInputInPart.value;
    const partId = detailIdInput.value;
    if (unitId && partId) {
      let parts = JSON.parse(localStorage.getItem(unitId + '_parts') || '[]');
      if (!parts.includes(partId)) {
        parts.push(partId);
        localStorage.setItem(unitId + '_parts', JSON.stringify(parts));
      }
    }
  });
});
</script>
<script>
function submitFinal(type) {
  const isUnit = type === 'unit';
  const form = document.querySelector(isUnit ? '#unit-form-block form' : '#part-form-block form');
  const inputs = form.querySelectorAll('input, select, textarea');

  const data = {};
  inputs.forEach(input => {
    if (input.name) {
      data[input.name] = input.value;
    }
  });

  data.mode = type;

  fetch('https://script.google.com/macros/s/AKfycby2xNlk8A2Ha_RkCOo8gK9Ia_bnmmNN5UT12EqBKfc1WEgONN6bD2__xTf7ylUHeh9m/exec', {
    method: 'POST',
    body: new URLSearchParams(data),
    redirect: "follow"
  })
  .then(response => response.text())
  .then(result => {
    console.log("Ответ от сервера:", result);
    showForm('success-block');
  })
  .catch(error => {
    alert("Ошибка при отправке данных. Проверьте соединение или консоль.");
    console.error("Ошибка:", error);
  });
}
</script>

</body>
</html>
